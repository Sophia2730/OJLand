<!DOCTYPE html>
<html>
<head>
    <% include ../nav/header.ejs %>
    <style>
        td {
            vertical-align: middle !important;
        }
        #Img img {
            width: 200px;
            height: 150px;
            margin: 10px;
            border: solid 1px black;
        }
    </style>
</head>
<body class="fixed-nav" id="page-top">
  <% include ../nav/nav-login.ejs %>
  <div class="container-fluid">
    <div class="card mb-3 mt-3">
        <% if(session.UserType == 'ER') { %>
            <div class="card-header"><h3>발주내역</h3></div>
            <div class="card-body">
                <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                    <tr>
                        <th>No.</th>
                        <th>카테고리</th>
                        <th>제목</th>
                        <th>급여</th>
                        <th>등록일</th>
                        <th>상태</th>
                        <th>수주자</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% for(var i = 0; i < data.length; i++) { if (data[i].Title) { %>
                        <tr class="text-center">
                            <td><%= i+1 %></td>
                            <td><%= data[i].Category %></td>
                            <td>
                                <a href="/info/<%= data[i]._OID %>"><%= data[i].Title %></a>
                            </td>
                            <td><%= data[i].Cost %></td>
                            <td><%= date[i] %></td>
                            <% if(data[i].Status == 'A' ) { %>
                                <td>모집 중</td>
                            <% } else if(data[i].Status == 'B'){ %>
                                <td>매칭 중</td>
                            <% } else if(data[i].Status == 'C'){ %>
                                <td>매칭완료</td>
                            <% } else if(data[i].Status == 'D'){ %>
                                <td>외주완료</td>
                            <% } else if(data[i].Status == 'F'){ %>
                                <td>매칭실패</td>
                            <% } %>
                            <% if (data[i].Status == 'B' || data[i].Status == 'C') { %>
                                <td><a id="<%= data[i]._OID %>" data-toggle="modal" data-target="#info_EE" href="">수주자 조회</a></td>
                            <% } else { %>
                                <td></td>
                            <% } %>
                        </tr>
                    <% } } %>
                    </tbody>
                </table>
              </div>
            </div>
        <% } else if(session.UserType == 'EE') { %>
            <div class="card-header"><h3>수주내역</h3></div>
            <div class="card-body">
                <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                      <tr>
                          <th>No.</th>
                          <th>카테고리</th>
                          <th>제목</th>
                          <th>급여</th>
                          <th>발주자</th>
                          <th>상태</th>
                      </tr>
                    </thead>
                    <tbody>
                    <% for(var i = 0; i < data.length; i++) {  if (data[i].Title) { %>
                      <tr>
                          <td><%= i+1 %></td>
                          <td><%= data[i].Category %></td>
                          <td><a href="/info/<%= data[i]._OID %>"><%= data[i].Title %></a></td>
                          <td><%= data[i].Cost %></td>
                          <td><a id="<%= data[i]._UID %>" data-toggle="modal" data-target="#myModal" href=""><%= data[i].Name %></a></td>
                          <td></td>
                      </tr>
                    <% } } %>
                    </tbody>
                </table>
              </div>
            </div>
        <% } %>
        <a class="btn btn-primary mb-3 mx-auto" href="/mypage">돌아가기</a>
    </div>
  </div>
  <% include ./modal_ER.ejs %>
  <% include ../match/info_EE.ejs %>
  <% include ../match/evaluate.ejs %>
  <% include ../progress/modal_list.ejs %>
  <script>
      <% if (session.UserType == 'EE') {
          for (var i = 0; i < data.length; i++) { %>
            $.get('/ordered_list/status/<%= data[i]._OID %>', function(data) {
                console.log(data);
                var status;
                if (data == 'A')
                    status = '매칭대기';
                else if (data =='B')
                    status = '매칭완료';
                else if (data =='C')
                    status = '외주완료';
                else if (data =='F')
                    status = '매칭실패';

                $("a[id=<%= data[i]._UID %>]").parent().next().text(status);
            });
      <% }
      } %>
  </script>
  </body>
</html>
