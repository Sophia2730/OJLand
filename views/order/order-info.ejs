<!DOCTYPE html>
<html>
  <head>
      <% include ../nav/header.ejs %>
      <style>
          .container {
              position: relative;
              top:65px;
              left:55px;
          }
          #Img img {
              width: 200px;
              height: 150px;
              margin: 10px;
              border: solid 1px black;
          }
      </style>
  </head>
  <body class="fixed-nav sidenav-toggled" id="page-top">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
          <% include ../nav/nav-login.ejs %>
      </nav>
      <div class="content-wrapper">
        <h1 style="margin: 10px;">&nbsp;<i class="fa fa-fw fa-eye"></i>발주정보</h1>
         <table style="margin-top:20px; width: 95%;" align="center" class="table table-bordered table-hover text-center">
           <tbody>
             <tr>
                <td style="width:10%;">카테고리</td>
                <td style="width:10%;">디자인</td>
                <td style="width:10%;">제목</td>
                <td colspan="3" style="text-align:left;"><%= data.Title %></td>
                <td>등록일</td>
                <td><%= date %></td>
             </tr>
             <tr>
                <td>발주자</td>
                <td><%= user.Name %></td>
                <td>전화번호</td>
                <td><%= user.Tel %></td>
                <td>이메일</td>
                <td><%= user.Email %></td>
                <td colspan="2"></td>
             </tr>
             <tr>
              <td>인원</td>
              <td><%= reqNum %>/<%= data.MaxNum %></td>
              <td>급여</td>
              <td><%= data.Cost %></td>
              <td style="width:10%;">기간</td>
              <td><%= data.Period %></td>
              <td style="width:10%;">학부제한</td>
              <td><%= data.Colleage %></td>
             </tr>
             <tr>
              <td>우대조건</td>
              <td colspan="3">
                <ul class="prefer" style="list-style:none;margin: 0 !important;padding:0 !important;">
                    <li style="margin-bottom: 5px;text-align:left;">
                      <% for (var i = 0; i < preference.length; i++) { %>
                        <% if (preference[i] != '') { %>
                            <p>[<%= i+1 %>] <%= preference[i] %></p>
                        <% } %>
                      <% } %>
                    </li>
                </ul>
              </td>
              <td colspan="4">
              </td>
             </tr>
             <tr>
                <td>내용</td>
                <td colspan="7"><textarea rows="5" style="width:100%;" readonly><%= data.Content %></textarea></td>
             </tr>
           </tbody>
         </table>
         <div class="btns" style="margin-bottom: 20px" align="center">
            <% if (data._UID == session._UID) { %>
                <% if (data.Status == 'A') { %>
                    <form method="POST" action="/info/<%= data._OID %>" style="margin:0 !important;display:inline-block;">
                        <a id="close" class="btn btn-success text-white mr-3" href="">마감</a>
                    </form>
                    <% if (!apps[0]) { %>
                      <a class="btn btn-primary mr-3" href="/put/<%= data._OID %>">수정</a>
                      <form method="POST" action="/info/<%= data._OID %>?_method=DELETE" style="margin:0 !important;display:inline-block;">
                          <input type="submit" class="btn btn-danger mr-3" value="삭제" />
                      </form>
                    <% } %>
                <% } else if (data.Status == 'B') { %>
                    <a id="match" class="btn btn-primary text-white mr-3" data-toggle="modal" data-target="#myMatch">매칭</a>
                <% } else { %>
                <% } %>
            <% } else if (session.UserType == 'EE') { %>
              <% if (!isReq && data.Status == 'A') { %>
                <a class="btn btn-success mr-3"data-toggle="modal" data-target="#myModal" href="">수주요청</a>
              <% } else if (data.Status != 'C') { %>
                    <a class="btn btn-danger mr-3"data-toggle="modal" data-target="#myProgress" href="">진척도 작성</a>
              <% } else if (isReq && data.Status == 'A'){ %>
                <form method="POST" action="/req/<%= data._OID %>?_method=DELETE" style="display:inline-block">
                    <input type="submit" class="btn btn-danger mr-3" value="요청취소" />
                </form>
              <% } %>
            <% } %>
            <!-- <a class="btn btn-info" href="/<%= (session.UserType == 'AD') ? 'admin' : 'list' %>">목록</a> -->
            <button type="button" class="btn btn-info" onClick="back();">목록</button>
         </div>
     </div>
     <% if (session.UserType == 'EE') { %>
       <% include ./request.ejs %>
       <% include ../progress/post.ejs %>
     <% } else { %>
       <% include ../match/match.ejs %>
     <% } %>
     <script>
        function back() {
            history.go(-1);
        }

        $("#close").on('click', function(e) {
            var answer = confirm('정말로 마감하시겠습니까?');
            if (!answer)
                e.preventDefault();
            else {
                $.post('/close/' + <%= data._OID %> + '?_method=PUT');
            }
        });

        $("input[type=submit]").on('click', function(e) {
            if($(this).val() == "삭제") {
                var answer = confirm('정말로 삭제하시겠습니까?');
                if (!answer)
                  e.preventDefault();
            } else if ($(this).val() == "요청취소") {
                var answer = confirm('정말로 취소하시겠습니까?');
                if (!answer)
                  e.preventDefault();
            }
        });
     </script>
  </body>
</html>
